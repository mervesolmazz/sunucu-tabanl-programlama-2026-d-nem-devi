<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genel Verimlilik Raporu</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="main-container">
        <a href="dashboard.html" class="btn btn-back">â† Panele DÃ¶n</a>

        <div class="top-header" style="display: block; text-align: center;">
            <h1>Genel Verimlilik Raporu</h1>
            <p style="margin: 0;">TÃ¼m kaynaklarÄ±n (Personel, Yatak, Ekipman) Ã§apraz risk analizi</p>
        </div>

        <!-- Riskler -->
        <div style="margin-bottom: 40px;">
            <h2 style="color: var(--danger-color); display: flex; align-items: center; gap: 10px;">
                ğŸš¨ Kritik UyarÄ±lar
            </h2>
            <div id="riskListesi" class="grid-menu" style="grid-template-columns: 1fr; gap: 15px; margin-top: 20px;">
                <div class="card" style="text-align: center; color: var(--text-light);">Analiz yapÄ±lÄ±yor...</div>
            </div>
        </div>

        <!-- Ã–zet -->
        <div>
            <h2 style="color: var(--secondary-color);">
                ğŸ“ˆ Performans Ã–zeti
            </h2>
            <div class="card" style="margin-top: 20px;">
                <p>DetaylÄ± bÃ¶lÃ¼m performans metrikleri aÅŸaÄŸÄ±dadÄ±r.</p>
                <div id="ozetListesi">Veriler alÄ±nÄ±yor...</div>
            </div>
        </div>
    </div>

    <script>
        async function loadReport() {
            try {
                // Paralel veri Ã§ekimi
                const [resYatak, resPersonel, resEkipman] = await Promise.all([
                    fetch('/bolumler/verimlilik'),
                    fetch('/personeller/karneler'),
                    fetch('/ekipmanlar/verimlilik')
                ]);

                const yatakData = await resYatak.json();
                const personelData = await resPersonel.json();
                const ekipmanData = await resEkipman.json();

                let riskHtml = '';

                // 1. Verimsiz BÃ¶lÃ¼mler
                if (yatakData.verimsiz_bolumler) {
                    yatakData.verimsiz_bolumler.forEach(b => {
                        riskHtml += `
                        <div class="card" style="border-left: 5px solid var(--danger-color); display: flex; align-items: center; gap: 15px; padding: 20px; text-align: left;">
                            <div style="font-size: 24px;">âŒ</div>
                            <div>
                                <h3 style="margin: 0; color: var(--text-main); font-size: 1.1rem;">${b.bolum_adi}</h3>
                                <p style="margin: 0; font-size: 0.9rem;">Yatak kullanÄ±mÄ± Ã§ok dÃ¼ÅŸÃ¼k (Ort: ${parseFloat(b.ortalama_yatak_kullanimi).toFixed(1)}). KapatÄ±lmasÄ± Ã¶nerilir.</p>
                            </div>
                        </div>`;
                    });
                }

                // 2. Personel EksikliÄŸi
                personelData.forEach(p => {
                    if (p.karar.includes('ACÄ°L')) {
                        riskHtml += `
                        <div class="card" style="border-left: 5px solid var(--warning-color); display: flex; align-items: center; gap: 15px; padding: 20px; text-align: left;">
                            <div style="font-size: 24px;">âš ï¸</div>
                            <div>
                                <h3 style="margin: 0; color: var(--text-main); font-size: 1.1rem;">${p.sube}</h3>
                                <p style="margin: 0; font-size: 0.9rem;">${p.karar}</p>
                            </div>
                        </div>`;
                    }
                });

                // 3. Ekipman YetersizliÄŸi
                ekipmanData.filter(e => e.verimlilik_skoru < 1).forEach(e => {
                    riskHtml += `
                    <div class="card" style="border-left: 5px solid var(--primary-dark); display: flex; align-items: center; gap: 15px; padding: 20px; text-align: left;">
                        <div style="font-size: 24px;">ğŸ”Œ</div>
                        <div>
                            <h3 style="margin: 0; color: var(--text-main); font-size: 1.1rem;">${e.ekipman_turu_adi} (${e.bolum_adi})</h3>
                            <p style="margin: 0; font-size: 0.9rem;">Kapasite yetersiz! (Skor: ${parseFloat(e.verimlilik_skoru).toFixed(2)})</p>
                        </div>
                    </div>`;
                });

                if (riskHtml === '') {
                    riskHtml = `
                    <div class="card" style="border-left: 5px solid var(--success-color); padding: 30px; text-align: center;">
                        <h3 style="color: var(--success-color);">âœ… Sistem Stabil</h3>
                        <p style="margin: 0;">Harika! HiÃ§bir kritik risk bulunamadÄ±.</p>
                    </div>`;
                }

                document.getElementById('riskListesi').innerHTML = riskHtml;
                document.getElementById('ozetListesi').innerHTML = '<p style="color: var(--success-color);">TÃ¼m veriler baÅŸarÄ±yla analiz edildi.</p>'; // Ã–zet kÄ±smÄ± iÃ§in placeholder

            } catch (err) { console.error(err); }
        }
        loadReport();
    </script>
</body>

</html>