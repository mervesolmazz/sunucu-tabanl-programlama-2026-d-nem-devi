<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gelecek Tahmin Analizi</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="main-container">
        <a href="dashboard.html" class="btn btn-back">â† Panele DÃ¶n</a>

        <div class="top-header" style="display: block; text-align: center;">
            <h1>ğŸ”® Gelecek Ay Tahminleri</h1>
            <p style="margin: 0;">Yapay zeka destekli (Lineer Regresyon) hasta sayÄ±sÄ± Ã¶ngÃ¶rÃ¼leri</p>
        </div>

        <!-- Grafik -->
        <div class="card chart-wrapper">
            <canvas id="tahminChart"></canvas>
        </div>

        <!-- Tahmin KartlarÄ± -->
        <div id="tahminKartlari" class="grid-menu" style="margin-top: 30px;">
            <p style="text-align: center; width: 100%;">Analiz yapÄ±lÄ±yor...</p>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                const res = await fetch('/analiz/tahmin');
                const data = await res.json();

                // Grafik Verilerini HazÄ±rla
                const labels = data.map(d => d.bolum_adi);
                const currentVal = data.map(d => d.mevcut_hasta);
                const nextVal = data.map(d => d.tahmini_hasta);

                // Grafik Ã‡iz
                const ctx = document.getElementById('tahminChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Mevcut Durum',
                                data: currentVal,
                                borderColor: '#94a3b8', // Gri
                                backgroundColor: '#94a3b8',
                                tension: 0.4
                            },
                            {
                                label: 'Gelecek Ay Tahmini',
                                data: nextVal,
                                borderColor: '#8b5cf6', // Mor
                                backgroundColor: '#8b5cf6',
                                borderDash: [5, 5], // Kesikli Ã§izgi (Tahmin olduÄŸu belli olsun)
                                tension: 0.4,
                                pointRadius: 6
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: { display: true, text: 'BÃ¶lÃ¼m BazlÄ± Hasta SayÄ±sÄ± Trendi' }
                        }
                    }
                });

                // KartlarÄ± OluÅŸtur
                let html = '';
                data.forEach(d => {
                    const artisVar = d.tahmini_hasta > d.mevcut_hasta;
                    const renk = artisVar ? 'status-critical' : 'status-normal'; // ArtÄ±ÅŸ varsa yoÄŸunluk artacak demektir (Kritik/Dikkat)
                    const icon = artisVar ? 'ğŸ“ˆ' : 'ğŸ“‰';

                    html += `
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 30px; margin-bottom: 10px;">${icon}</div>
                        <h3>${d.bolum_adi}</h3>
                        <div style="margin: 15px 0; font-size: 1.2rem; font-weight: bold;">
                            ${d.mevcut_hasta} â <span style="color: var(--secondary-color);">${d.tahmini_hasta}</span>
                        </div>
                        <span class="status-badge ${renk}">
                            ${artisVar ? 'ArtÄ±ÅŸ Bekleniyor' : 'DÃ¼ÅŸÃ¼ÅŸ Bekleniyor'} (%${Math.abs(d.degisim_orani)})
                        </span>
                    </div>`;
                });
                document.getElementById('tahminKartlari').innerHTML = html;

            } catch (err) { console.error(err); }
        }
        loadData();
    </script>
</body>

</html>